"use strict";var dataService={getInstance(b){function l(b){k[b._id]=new a(b.title,b.author,b.category,b.imgUrl,b.price,b.pages,b.description)}function m(a){k[a._id]=void 0}function n(a){let c=btoa(`${h}:${i}`),g={Authorization:`Basic ${c}`};return b.postJSON(`https://baas.kinvey.com/user/${h}/login`,a,g).then((a=>{localStorage.setItem(d,a.username),localStorage.setItem(e,a._kmd.authtoken),localStorage.setItem(f,a._id)}))}function o(a){let c=btoa(`${h}:${i}`),d={Authorization:`Basic ${c}`};return b.postJSON(`https://baas.kinvey.com/user/${h}/`,a,d)}function p(){let a={},c={Authorization:`Kinvey ${localStorage.getItem(e)}`};return b.postJSON(`https://baas.kinvey.com/user/${h}/_logout`,a,c).then((a=>{console.log(a),localStorage.removeItem(d),localStorage.removeItem(e),localStorage.removeItem(f)}))}function q(){return Promise.resolve().then((()=>{return!!localStorage.getItem(d)}))}function r(){let a={Authorization:`Kinvey ${localStorage.getItem(e)}`};return b.getJSON(`https://baas.kinvey.com/user/${h}/${localStorage.getItem(f)}`,a).then((a=>{return a.books}))}function s(a){return r().then((c=>{c.push(a);let d={Authorization:`Kinvey ${localStorage.getItem(e)}`};return b.getJSON(`https://baas.kinvey.com/user/${h}/${localStorage.getItem(f)}`,d).then((a=>{var e={books:c,username:a.username,address:a.address,phone:a.phone,email:a.email};return b.putJSON(`https://baas.kinvey.com/user/${h}/${localStorage.getItem(f)}`,e,d)}))}))}function u(a){return r().then((c=>{for(let d=0;d<c.length;d+=1)if(a._id==c[d]._id){c.splice(d,1);break}let g={Authorization:`Kinvey ${localStorage.getItem(e)}`};return b.getJSON(`https://baas.kinvey.com/user/${h}/${localStorage.getItem(f)}`,g).then((a=>{var d={books:c,username:a.username,address:a.address,phone:a.phone,email:a.email};return b.putJSON(`https://baas.kinvey.com/user/${h}/${localStorage.getItem(f)}`,d,g)}))}))}function v(){let a={Authorization:`Kinvey ${localStorage.getItem(e)}`};return b.getJSON(`https://baas.kinvey.com/user/${h}/${localStorage.getItem(f)}`,a).then((c=>{var d={books:[],username:c.username,address:c.address,phone:c.phone,email:c.email};return b.putJSON(`https://baas.kinvey.com/user/${h}/${localStorage.getItem(f)}`,d,a)}))}function w(a){let c=btoa(`${h}:${j}`),d=a,e={Authorization:`Basic ${c}`};return l(a),b.postJSON(`https://baas.kinvey.com/appdata/${h}/booksDataBase`,d,e).catch((()=>{m(d)}))}function x(a,c){let d=btoa(`${h}:${j}`),e={Authorization:`Basic ${d}`};return l(c),b.putJSON(`https://baas.kinvey.com/appdata/${h}/booksDataBase/${a}`,c,e).catch((()=>{m(c)}))}function y(){let c=btoa(`${h}:${j}`),d={Authorization:`Basic ${c}`};return b.getJSON(`https://baas.kinvey.com/appdata/${h}/booksDataBase`,d).then((b=>{return b.forEach((b=>{k[b._id]=new a(b.title,b.author,b.category,b.imgUrl,b.price,b.pages,b.description)})),k}))}function z(a){if(k[a])return Promise.resolve(k[a]);{let c={Authorization:`Kinvey ${localStorage.getItem(e)}`};return b.getJSON(`https://baas.kinvey.com/appdata/${h}/booksDataBase/${a}`,c).then((a=>{return l(a),a}))}}function A(a){return r().then((c=>{let d={userId:localStorage.getItem(f),books:c,status:"open",totalPrice:a},g={Authorization:`Kinvey ${localStorage.getItem(e)}`};return b.postJSON(`https://baas.kinvey.com/appdata/${h}/orders`,d,g)}))}function B(){let a={Authorization:`Kinvey ${localStorage.getItem(e)}`};return b.getJSON(`https://baas.kinvey.com/appdata/${h}/orders/?query={"userId":"${localStorage.getItem(f)}"}`,a)}function C(){let a={Authorization:`Kinvey ${localStorage.getItem(e)}`};return b.getJSON(`https://baas.kinvey.com/user/${h}/${localStorage.getItem(f)}`,a)}function D(a){let c={Authorization:`Kinvey ${localStorage.getItem(e)}`};return b.putJSON(`https://baas.kinvey.com/user/${h}/${localStorage.getItem(f)}`,a,c)}const d="username",e="authKey",f="userID",h="kid_SkGEDPt6",i="1ddc36c888904211906588c736731c4d",j="2c9b407d779742d18a5e4afef9700855";var k={};return{login:n,register:o,logout:p,isLoggedIn:q,getCart:r,addToCart:s,removeFromCart:u,createBookInstance:w,updateBookInstance:x,getAllBooks:y,getBookById:z,placeOrder:A,clearCart:v,getCurrentUserData:C,getOrdersByUserId:B,updateUserData:D}}};class a{constructor(a,b,c,d,e,f,g){this.title=a,this.author=b,this.category=c,this.imgUrl=d,this.price=e,this.pages=f,this.description=g}get title(){return this._title}set title(a){this._title=a}get author(){return this._author}set author(a){this._author=a}get category(){return this._category}set category(a){this._category=a}get imgUrl(){return this._imgUrl}set imgUrl(a){this._imgUrl=a}get price(){return this._price}set price(a){this._price=a}get pages(){return this._pages}set pages(a){this._pages=a}get description(){return this._description}set description(a){this._description=a}}class b{constructor(a,b,c,d,e,f,g){this.username=a,this.password=b,this.firstName=c,this.lastName=d,this.email=e,this.address=f,this.phoneNumber=g}get username(){return this._username}set username(a){if(a=_formatInputData(a),/[^A-Za-z0-9-_.]/g.test(a))throw new Error("Username can only contain only latin letters, numbers, dash, underscore or a dot!");this._username=a}get password(){return this._password}set password(a){a=_formatInputData(a),this._password=a}get firstName(){return this._firstName}set firstName(a){a=_formatInputData(a),_validateName(a),this._firstName=a}get lastName(){return this._lastName}set lastName(a){a=_formatInputData(a),_validateName(a),this._lastName=a}get email(){return this._email}set email(a){a=_formatInputData(a);let b=/^\w+@[a-zA-Z_]+?\.[a-zA-Z]{2,3}$/;if(a.match(b).length<1)throw new Error("Invalid email address!");this._email=a}get address(){return this._address}set address(a){a=_formatInputData(a),this._address=a}get phoneNumber(){return this._phoneNumber}set phoneNumber(a){if(a=_formatInputData(a),/[^0-9]/g.test(a))throw new Error("Invalid telephone number!");this._phoneNumber=a}_formatInputData(a){function c(a){return String(a).replace(/[&<>"'\/]/g,function(a){return entityMap[a]})}a=a.trim();return a=c(a)}_validateName(a){if(/^[^A-Z]/.test(a))throw new Error("Name must begin with a capital letter!");for(let b=1;b<a.length;b+=1){if(/^a-z-/g.test(a[b]))throw new Error("Disallowed characters! A name must begin with a capital letter and continue with lower case latin symbols!");if("-"===a[b-1]&&"-"===a[b])throw new Error("There cannot be two or more successive dashes in a name!")}}}class c{constructor(a,b){this.name=a,this.description=b,this._books=[]}get name(){return this._name}set name(a){if("string"!=typeof a)throw new Error("Name must be a string.");this._name=a}get description(){return this._description}set description(a){if("string"!=typeof a)throw new Error("Description must be a string.");if(a.length<=10&&a.length>50)throw new Error("Description must be between 10 and 50 symbols long.");this._description=a}get books(){return this._books}set books(a){throw new Error("Books cannot be changed.Use add remove or removeAll methods instead.")}add(b){if(!(b instanceof a))throw new Error("Only books can be added.");this.books.push(b)}remove(a){var b=this.books.indexOf(a);if(b<0)throw new Error("Book not found.");this.books.splice(b,1)}removeAll(){this._books=[]}}"undefined"==typeof window&&(module.exports={Book:a,User:b,Author:c});let d={getInstance(a,b,c){function e(a){d.html(a)}function f(){a.isLoggedIn().then((a=>{a?(c("#logged-in").removeClass("hidden"),c("#logged-out").addClass("hidden")):(c("#logged-in").addClass("hidden"),c("#logged-out").removeClass("hidden"))}))}function g(){f(),b.compile("products").then((a=>{e(a)})),a.getAllBooks().then((a=>{let c={books:a};return b.compile("products",c)})).then((a=>{e(a)}))}function j(c){a.getAllBooks().then((a=>{let d=[],e=decodeURI(c.productName).toLowerCase();for(let f in a)d.push(a[f]),d[d.length-1]._id=f;let g=[];for(let h of d)(h.title.toLowerCase().indexOf(e)>0||h.author.toLowerCase().indexOf(e)>0||h.category.toLowerCase().indexOf(e)>0||h.description.toLowerCase().indexOf(e)>0)&&g.push(h);console.log(d),console.log(g);let i={searchValue:decodeURI(c.productName)};return g.length>0&&(i.books=g),b.compile("search",i)})).then((a=>{e(a)}))}function k(c){a.getAllBooks().then((a=>{let d=[],e=decodeURI(c.category);if("all-categories"==c.category)for(let b in a)d.push(a[b]),d[d.length-1]._id=b;else for(let b in a)a[b].category.toLowerCase()==e.toLowerCase()&&(d.push(a[b]),d[d.length-1]._id=b);let f={};return d.length>0&&(f={books:d}),"all-categories"==c.category?f.sectionCategory="All Categories":f.sectionCategory=e.substr(0,1).toUpperCase()+e.substr(1),b.compile("category",f)})).then((a=>{e(a)}))}function l(d){let f;a.getBookById(d.id).then((a=>{return f=a,a.pageUrl=encodeURIComponent(window.location.href),b.compile("book-instance",a)})).then((b=>{e(b),c("#btn-add-to-cart").on("click",(()=>{if(!a.isLoggedIn())throw new Error("You must be logged in to add a book to the cart!");a.addToCart(f).then(((a,b)=>{b||toastr.success("Book added to cart!")})).catch((a=>{toastr.error(a.responseJSON.description+". Please log in!")}))}))})).catch((a=>{toastr.error(a)}))}function m(){b.compile("about").then((a=>{e(a)}))}function n(){b.compile("contacts").then((a=>{e(a)}))}var d=c("#container");if(d.length<1)throw new Error("No #container found on page!");return f(),{home:g,search:j,categories:k,productById:l,about:m,contacts:n}}};"undefined"==typeof window&&(module.exports=d.getInstance);let e={getInstance(a){return{get(b){return new Promise(((c,d)=>{a.ajax({url:b,method:"GET",success(a){c(a)},error(a){d(a)}})}))},putJSON(b,c,d={}){return new Promise(((e,f)=>{a.ajax({url:b,headers:d,method:"PUT",contentType:"application/json",data:JSON.stringify(c),success(a){e(a)},error(a){f(a)}})}))},postJSON(b,c,d={}){return new Promise(((e,f)=>{a.ajax({url:b,headers:d,method:"POST",contentType:"application/json",data:JSON.stringify(c),success(a){e(a)},error(a){f(a)}})}))},getJSON(b,c={}){return new Promise(((d,e)=>{a.ajax({url:b,method:"GET",headers:c,contentType:"application/json",success(a){d(a)},error(a){e(a)}})}))}}}};"undefined"==typeof window&&(module.exports=e.getInstance);let f={getInstance(a,b){function d(b){if(c[b])return Promise.resolve(c[b]);{let d=`./templates/${b}.handlebars`;return a.get(d).then((a=>{return c[b]=a,Promise.resolve(a)}))}}function e(a,c){var e=d(a).then((a=>{var d=b.compile(a);return d(c)}));return e}var c={};return{compile:e}}};"undefined"==typeof window&&(module.exports=f);let g={getInstance(a,b,c){function e(a){d.html(a)}function f(){a.isLoggedIn().then((a=>{a?(c("#logged-in").removeClass("hidden"),c("#logged-out").addClass("hidden")):(c("#logged-in").addClass("hidden"),c("#logged-out").removeClass("hidden"))}))}function g(){var d=0;a.getCart().then((a=>{a.forEach((a=>{d+=a._price}));var c={};return a.length>0&&(d=Math.round(100*d)/100,c={books:a,totalPrice:d}),b.compile("cart",c)})).then((b=>{e(b),c(".remove-from-cart").click((b=>{var d=c(b.target).attr("data-book-id");a.getBookById(d).then((b=>{return a.removeFromCart(b)})).then((()=>{g()}))})),c("#checkout-btn").click((b=>{a.placeOrder(d).then((()=>{return toastr.success("Order has been successfully placed!"),a.clearCart()})).then((()=>{c(location).attr("href","#/products")})).catch((a=>{toastr.error(a.responseJSON.description)}))}))}))}function h(){b.compile("login").then(function(b){e(b),c("#btn-login").on("click",function(){var b={username:c("#tb-username").val().trim(),password:c("#tb-password").val().trim()};a.login(b).then(function(){toastr.success("User Logged in!"),c(location).attr("href","#/products")}).catch((a=>{toastr.error(a.responseJSON.description),c("#tb-username").val(""),c("#tb-password").val("")}))})})}function i(){b.compile("register").then(function(b){e(b),c("#btn-register").on("click",function(){var b={username:c("#tb-username").val(),password:c("#tb-password").val(),email:c("#tb-email").val(),phone:c("#tb-phone").val(),address:c("#tb-address").val(),books:[]};a.register(b).then(function(){console.log("User registered!"),toastr.success("User registered")}).catch((a=>{toastr.error(a.responseJSON.description)}))})})}function j(){a.logout().then(function(){toastr.success("User Logged out!"),c(location).attr("href","#/products")})}function k(){let d,f;Promise.all([a.getCurrentUserData(),a.getOrdersByUserId()]).then((a=>{return d=a[0],f=a[1],{user:d,orders:f}})).then((a=>{return b.compile("profile",a)})).then((b=>{e(b),c("#submit-user-data").click((b=>{var e=c("#profile-form")[0];e.checkValidity&&!e.checkValidity()||(d.address=c("#user-address-input").val(),d.phone=c("#user-phone-input").val(),console.log(d),a.updateUserData(d).then((()=>{c(location).attr("href","#/products"),toastr.success("Your profile information has been updated!")})).catch((a=>{toastr.error(a.responseJSON.description)})))}))})).catch((a=>{toastr.error(a.responseJSON.description)}))}var d=c("#container");if(d.length<1)throw new Error("No #container found on page!");return f(),{login:h,register:i,logout:j,profile:k,cart:g}}},h=e.getInstance($),i=f.getInstance(h,Handlebars),j=dataService.getInstance(h),k=new Navigo(null,!0),l=g.getInstance(j,i,$),m=d.getInstance(j,i,$);k.on("/products",m.home).on("/login",l.login).on("/register",l.register).on("/logout",l.logout).on("/profile",l.profile).on("/cart",l.cart).on("/search/:productName",m.search).on("/products/:category",m.categories).on("/products/review/:id",m.productById).on("/about",m.about).on("/contacts",m.contacts).on("/home",(()=>{k.navigate("/products")})).on("/",(()=>{k.navigate("/products")})).on("",(()=>{k.navigate("/products")})).resolve(),$("#btn-search").on("click",(()=>{let a=$("#search-bar"),b=encodeURI(a.val().trim());b&&(k.navigate(`/search/${b}`),a.val(""))})),toastr.options={closeButton:!0,debug:!1,newestOnTop:!0,progressBar:!1,positionClass:"toast-top-center",preventDuplicates:!0,onclick:null,showDuration:"300",hideDuration:"300",timeOut:"2000",extendedTimeOut:"1000",showEasing:"swing",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"};